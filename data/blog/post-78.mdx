---
  title: 模型集成技术核心知识点
  publishedAt: 2025-10-23T08:23:09Z
  summary: 查看全文>>
  tags: ["AI"]
---

> 本文为学习模型集成技术笔记：
> 1、学习推理前集成、推理中集成、推理后集成
> 2、实现模型选择与路由系统
> 3、探索模型输出的融合策略


## 一、推理阶段相关集成技术

### （一）推理前集成

推理前集成主要是在模型进行推理计算之前，对模型、数据或输入等方面进行整合处理，目的是为后续的推理过程打下良好基础，提升推理效率和准确性。



1. **核心思路**：在模型推理开始前，通过对模型结构、输入数据等进行预处理和整合，减少推理过程中的冗余操作，让模型以更优的状态进入推理阶段。

2. **关键技术点**

* **模型结构融合**：将多个功能相似或互补的子模型的结构进行合并。例如，在图像识别任务中，把不同卷积核大小的特征提取子模型融合成一个更高效的特征提取网络，减少模型间的交互开销，提升整体推理速度。

* **输入数据预处理集成**：将原本分散在不同步骤的数据预处理操作（如数据清洗、归一化、特征选择等）整合为一个统一的处理流程。比如在自然语言处理任务中，将文本分词、去除停用词、词向量转换等操作集成，避免在推理过程中多次对数据进行处理，减少数据传输和处理的时间成本。

* **模型参数共享**：对于多个具有部分相同功能的模型，让它们共享部分参数。例如，在多任务学习场景中，不同任务的模型可以共享底层的特征提取参数，不仅减少了参数存储量，降低模型加载的资源消耗，还能通过参数共享提升模型的泛化能力。

### （二）推理中集成

推理中集成是在模型进行推理计算的过程中，动态地对模型的计算过程、数据流向等进行调整和整合，以适应不同的推理需求和场景变化。



1. **核心思路**：根据推理过程中的实时情况，如输入数据的特征、模型的计算状态等，灵活地调整模型的结构和计算方式，实现更高效、更精准的推理。

2. **关键技术点**

* **动态模型选择**：在推理过程中，根据输入数据的特点选择合适的子模型进行计算。例如，在图像分类任务中，对于简单的图像（如背景单一、目标清晰），选择结构简单、计算量小的子模型进行推理；对于复杂的图像（如背景复杂、目标模糊），则选择结构复杂、精度更高的子模型。这种动态选择机制可根据实际需求合理分配计算资源，提升推理效率与精度平衡效果。

* **实时数据分流**：将推理过程中的数据根据不同的计算需求分流到不同的模型模块或计算单元中进行处理。比如在视频分析任务中，将视频的帧数据分别分流到目标检测模块和目标跟踪模块，同时进行计算，提高整体推理效率。

* **中间结果复用**：在推理过程中，对于多个模型或模型模块共同需要的中间计算结果进行存储和复用，避免重复计算。例如，在多任务学习的图像处理模型中，多个任务（如图像分类、目标检测）都需要用到图像的底层特征，将这些底层特征计算结果存储起来，供后续任务使用，减少重复计算量，降低设备的计算负担。

### （三）推理后集成

推理后集成是在模型完成推理计算，得到各自的输出结果之后，对这些结果进行整合和优化，以得到最终更可靠、更准确的结论。



1. **核心思路**：由于不同模型可能存在不同的偏差和优势，通过对多个模型的推理结果进行综合分析和处理，弥补单个模型的不足，提高整体决策的准确性。

2. **关键技术点**

* **结果投票机制**：让多个模型对同一输入数据的推理结果进行投票，以得票最多的结果作为最终输出。例如，在分类任务中，有 3 个模型分别对输入数据进行分类，若 2 个模型认为是类别 A，1 个模型认为是类别 B，则最终结果确定为类别 A。这种机制简单直观，适用于对结果准确性要求不是极高，但需要快速得到结论的场景。

* **结果加权融合**：根据不同模型的性能和可靠性，为每个模型的推理结果分配不同的权重，然后将加权后的结果进行融合得到最终输出。例如，在回归任务中，模型 A 的预测误差较小，权重设置为 0.6；模型 B 的预测误差较大，权重设置为 0.4。若模型 A 的预测结果为 10，模型 B 的预测结果为 12，则最终融合结果为 10×0.6 + 12×0.4 = 10.8。可根据模型在历史数据上的表现动态调整权重，提升结果的准确性。

* **结果过滤与修正**：对多个模型的推理结果进行分析，去除异常结果，并对存在偏差的结果进行修正。例如，在目标检测任务中，若某个模型检测到的目标位置与其他多数模型检测到的位置偏差过大，则认为该结果为异常结果并予以剔除；对于存在轻微偏差的结果，根据其他模型的结果进行修正，使最终的目标检测结果更准确。这种方式能有效提高结果的可靠性。

## 二、模型选择与路由系统实现

模型选择与路由系统是模型集成技术中的重要组成部分，它负责根据不同的条件和需求，选择合适的模型，并将输入数据路由到对应的模型进行处理，同时还需要对整个过程进行监控和管理。

### （一）核心组成部分



1. **模型注册与管理模块**：负责对所有可用的模型进行注册、存储和管理。该模块需要记录每个模型的基本信息，如模型名称、功能描述、适用场景、输入输出格式、性能指标（如推理速度、准确率）等。可通过创建模型注册表的方式实现，将模型信息存储在指定位置，方便后续查询和调用。例如，使用 JSON 格式存储模型信息：



```json
{

"models": [

  {

    "modelName": "imageClassificationSimple",

    "function": "图像分类（简单场景）",

    "applicableScenario": "背景单一、目标清晰的图像",

    "inputFormat": "224×224 RGB图像",

    "outputFormat": "类别标签及概率",

    "performance": {

      "inferenceSpeed": "50ms/张",

      "accuracy": "92%"

    }

  },

  {

    "modelName": "imageClassificationComplex",

    "function": "图像分类（复杂场景）",

    "applicableScenario": "背景复杂、目标模糊的图像",

    "inputFormat": "224×224 RGB图像",

    "outputFormat": "类别标签及概率",

    "performance": {

      "inferenceSpeed": "150ms/张",

      "accuracy": "97%"

    }

  }

]

}
```



1. **条件判断模块**：根据预设的条件和输入数据的特征，判断应该选择哪个或哪些模型进行推理。条件可以包括输入数据的类型（如文本、图像、音频）、数据特征（如图像的分辨率、文本的长度）、用户需求（如推理速度优先、准确率优先）、设备性能（如 CPU、GPU、内存大小）、网络状况（如网络带宽、延迟）等。可通过编写条件判断函数实现，例如：



```javascript
function selectModel(inputData, userRequirement, devicePerformance) {

// 输入数据为图像

if (inputData.type === "image") {

  const imageResolution = inputData.resolution;

  // 图像分辨率低且用户要求推理速度优先，设备性能一般

  if (imageResolution < 300 && userRequirement === "speedFirst" && devicePerformance === "normal") {

    return "imageClassificationSimple";

  }&#x20;

  // 图像分辨率高或用户要求准确率优先，设备性能较好

  else {

    return "imageClassificationComplex";

  }

}

// 其他类型数据的判断逻辑...

}
```



1. **路由分发模块**：根据条件判断模块的结果，将输入数据路由到对应的模型进行推理。可通过发送请求或调用模型接口的方式实现数据路由。例如，若选择了 “imageClassificationSimple” 模型，则将图像数据发送到该模型的推理接口：



```javascript
function routeData(modelName, inputData) {

// 模拟发送请求到对应的模型接口

fetch(`/models/\${modelName}/infer`, {

  method: "POST",

  headers: {

    "Content-Type": "application/json"

  },

  body: JSON.stringify(inputData)

})

.then(response => response.json())

.then(inferenceResult => {

  // 处理推理结果

  handleInferenceResult(inferenceResult);

})

.catch(error => {

  console.error("模型推理请求失败：", error);

});

}
```



1. **监控与反馈模块**：对模型选择和路由的过程进行监控，记录相关日志（如选择的模型、路由的时间、数据传输的状态等），并根据推理结果和系统运行状况进行反馈和调整。可通过输出日志和提示信息的方式实现监控，例如：



```javascript
function monitorAndFeedback(modelName, routeTime, dataTransferStatus, inferenceResult) {

// 输出监控日志

console.log(`选择的模型：\${modelName}`);

console.log(`路由时间：\${routeTime}`);

console.log(`数据传输状态：${dataTransferStatus}`);

// 根据推理结果进行反馈，如显示结果或错误提示

if (inferenceResult.success) {

  console.log(`推理结果：\${inferenceResult.data}`);

} else {

  console.error(`推理错误：\${inferenceResult.errorMsg}`);

}

// 根据系统运行状况（如推理速度过慢）调整模型选择策略

if (inferenceResult.inferenceTime > 200 && modelName === "imageClassificationComplex") {

  console.warn("当前模型推理速度过慢，下次可考虑选择简单模型");

  // 调整模型选择的条件参数

  adjustModelSelectionParams();

}

}
```

### （二）实现流程



1. **初始化**：在系统启动时，加载所有可用模型的信息到模型注册与管理模块，初始化条件判断规则和路由分发规则。

2. **接收输入**：接收输入的数据和需求（如推理速度优先、准确率优先），同时获取当前设备的性能信息和网络状况。

3. **模型选择**：条件判断模块根据输入数据的特征、需求、设备性能和网络状况等条件，从模型注册与管理模块中选择合适的模型。

4. **数据路由**：路由分发模块将输入数据按照选择的模型，分发到对应的模型推理接口进行处理。

5. **监控反馈**：监控与反馈模块实时监控模型选择、数据路由和推理过程，记录相关日志，并根据推理结果和系统运行状况进行反馈和策略调整。

## 三、模型输出的融合策略探索

模型输出的融合策略是推理后集成的核心内容，通过合理的融合策略可以充分利用多个模型的优势，提高最终结果的准确性和可靠性。

### （一）常用融合策略



1. **投票法**

* **原理**：多个模型对同一输入数据进行推理，每个模型给出一个结果，最终选择得票最多的结果作为最终输出。投票法又可分为硬投票和软投票。

* **硬投票**：每个模型直接给出类别标签作为投票结果，统计每个类别得到的票数，票数最多的类别即为最终结果。例如，在二分类任务中，5 个模型中有 3 个模型预测为正类，2 个模型预测为负类，则最终结果为正类。硬投票简单易行，适用于类别标签明确的场景，但没有考虑模型预测的置信度。

* **软投票**：每个模型给出每个类别的概率（置信度），将多个模型对同一类别的概率进行平均，选择平均概率最高的类别作为最终结果。例如，在三分类任务中，模型 A 对类别 1、2、3 的概率分别为 0.6、0.3、0.1；模型 B 对类别 1、2、3 的概率分别为 0.5、0.4、0.1；模型 C 对类别 1、2、3 的概率分别为 0.7、0.2、0.1。则类别 1 的平均概率为 (0.6+0.5+0.7)/3 = 0.6，类别 2 的平均概率为 (0.3+0.4+0.2)/3 = 0.3，类别 3 的平均概率为 (0.1+0.1+0.1)/3 = 0.1，最终选择类别 1 作为结果。软投票考虑了模型的置信度，通常比硬投票的准确性更高，适用于对结果精度要求较高的场景。

* **适用场景**：在简单分类任务中，可使用硬投票快速得到结果；在需要较高精度的分类场景，可采用软投票提升准确性。

1. **加权融合法**

* **原理**：根据不同模型的性能（如准确率、召回率、F1 值等）或可靠性，为每个模型的输出结果分配不同的权重，然后将加权后的结果进行融合得到最终输出。权重的确定可以基于模型在历史数据集上的表现，也可以通过交叉验证等方法进行优化。

* **计算方式**：对于分类任务，若模型 i 对类别 c 的概率为 P ic，权重为 w i，则融合后类别 c 的概率为 P c = Σ(w i × P ic)，选择 P c 最大的类别作为最终结果；对于回归任务，若模型 i 的预测值为 y i，权重为 w i，则融合后的预测值为 y = Σ(w i × y i)。

* **权重确定方法**：


  * **经验权重**：根据开发人员的经验和对模型的了解，为不同模型分配权重。例如，认为模型 A 的准确率比模型 B 高 20%，则给模型 A 分配 0.6 的权重，模型 B 分配 0.4 的权重。这种方法简单快速，但主观性较强，适用于模型数量较少、对结果精度要求不是极高的场景。

  * **性能权重**：根据模型在验证集上的性能指标（如准确率）来确定权重。例如，模型 A 在验证集上的准确率为 95%，模型 B 的准确率为 90%，则权重可以设置为 w A = 95/(95+90) ≈ 0.51，w B = 90/(95+90) ≈ 0.49。这种方法基于客观的性能数据，比经验权重更合理。

  * **优化权重**：通过数学优化的方法（如梯度下降、遗传算法等）寻找最优的权重组合，使得融合后的结果在验证集上的性能达到最佳。例如，以融合结果的损失函数最小化为目标，通过梯度下降算法迭代更新权重。这种方法得到的权重准确性最高，但计算复杂度较大，若设备性能允许，可采用这种方法；若设备性能有限，可在后端预先计算好最优权重直接使用。

* **适用场景**：在回归任务中，如数值预测、指标估算等，可采用加权融合法，根据不同模型的历史预测误差分配权重，提高预测精度。

1. **堆叠融合法（Stacking）**

* **原理**：堆叠融合法是一种层次化的融合方法，它将多个基础模型（一级模型）的输出作为新的特征，输入到一个元模型（二级模型）中，由元模型进行最终的预测。堆叠融合法可以充分利用不同基础模型的特征信息，进一步提高模型的泛化能力和预测准确性。

* **实现步骤**：


  * **数据划分**：将数据集分为训练集和测试集，再将训练集分为一级训练集和二级训练集。

  * **一级模型训练与预测**：使用一级训练集训练多个不同的基础模型，然后用这些基础模型分别对二级训练集和测试集进行预测，得到二级训练集的预测结果（作为元模型的输入特征）和测试集的预测结果（作为元模型的输入特征之一）。

  * **元模型训练与预测**：将二级训练集的预测结果作为输入特征，结合原始训练集的标签，训练元模型。最后，将测试集的预测结果输入到元模型中，得到最终的预测结果。

* **适用场景**：在复杂任务中，如多标签分类、复杂场景下的回归预测等，堆叠融合法可以整合多个基础模型的优势，得到更准确的结果。但由于堆叠融合法的计算复杂度较高，实现时可将一级模型的训练和预测部分放在后端处理，前端或其他应用端主要负责接收一级模型的输出并进行后续融合操作。




---
本人自动发布于：[https://github.com/giscafer/blog/issues/78](https://github.com/giscafer/blog/issues/78)
